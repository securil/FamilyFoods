---
import { getRelativeLocaleUrl } from 'astro:i18n';
import { supportedLocales, localeNames, getLocaleFromUrl, translate } from '../../i18n/utils.js';

// 현재 로케일 감지
const currentLocale = getLocaleFromUrl(Astro.url);

// 번역 함수
export const t = (key) => translate(key, currentLocale);

// 언어 전환 링크 생성
export const languageLinks = () => {
  const path = Astro.url.pathname;
  
  // 현재 경로의 로케일 세그먼트 제거
  let pathWithoutLocale = path;
  if (supportedLocales.includes(path.split('/')[1])) {
    pathWithoutLocale = path.substring(path.indexOf('/', 1));
  }
  
  // 각 언어에 대한 링크 생성
  return supportedLocales.map(locale => {
    const url = locale === 'ko' 
      ? (pathWithoutLocale === '/' ? '/' : pathWithoutLocale) 
      : getRelativeLocaleUrl(locale, '');
      
    return {
      locale,
      name: localeNames[locale],
      url,
      current: locale === currentLocale
    };
  });
};

export { currentLocale, localeNames };
---