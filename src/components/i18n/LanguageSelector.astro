---
import { languageLinks, currentLocale, localeNames } from './I18nHelper.astro';

// 국가별 국기 이미지 매핑
const flagImages = {
  ko: '/images/flag-ko.svg',
  en: '/images/flag-en.svg',
  zh: '/images/flag-cn.svg', // 이미 중국어 국기 이미지가 있음
  vi: '/images/flag-vi.svg', // 추가 필요
  th: '/images/flag-th.svg', // 추가 필요
  ja: '/images/flag-ja.svg', // 추가 필요
};

// 언어 전환 링크 배열
const links = languageLinks();
---

<div class="language-selector">
  <div class="current-language">
    <img src={flagImages[currentLocale]} alt={localeNames[currentLocale]} title={localeNames[currentLocale]}>
    <span class="lang-name">{localeNames[currentLocale]}</span>
    <i class="arrow-down"></i>
  </div>
  <div class="language-dropdown">
    {links.map(link => (
      <a href={link.url} class={link.current ? 'active' : ''}>
        <img src={flagImages[link.locale]} alt={link.name} title={link.name}>
        <span>{link.name}</span>
      </a>
    ))}
  </div>
</div>

<style>
  .language-selector {
    position: relative;
    margin-left: 1rem;
    cursor: pointer;
    user-select: none;
  }
  
  .current-language {
    display: flex;
    align-items: center;
    padding: 0.5rem;
    border-radius: 4px;
    transition: background-color 0.2s;
  }
  
  .language-selector:hover .current-language {
    background-color: rgba(255, 255, 255, 0.1);
  }
  
  .current-language img {
    width: 24px;
    height: 16px;
    object-fit: cover;
    margin-right: 0.5rem;
    border-radius: 2px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }
  
  .lang-name {
    margin-right: 0.5rem;
    font-size: 0.9rem;
  }
  
  .arrow-down {
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid currentColor;
    margin-top: 2px;
  }
  
  .language-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background-color: white;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    padding: 0.5rem 0;
    display: none;
    z-index: 100;
    min-width: 160px;
    margin-top: 0.5rem;
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.3s, transform 0.3s;
  }
  
  .language-selector:hover .language-dropdown {
    display: block;
    opacity: 1;
    transform: translateY(0);
  }
  
  .language-dropdown a {
    display: flex;
    align-items: center;
    padding: 0.6rem 1rem;
    text-decoration: none;
    color: #333;
    transition: background-color 0.2s;
  }
  
  .language-dropdown a:hover {
    background-color: #f5f5f5;
  }
  
  .language-dropdown a.active {
    background-color: #f0f0f0;
    font-weight: 500;
    color: var(--primary-color);
  }
  
  .language-dropdown img {
    width: 24px;
    height: 16px;
    object-fit: cover;
    margin-right: 0.8rem;
    border-radius: 2px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }
  
  /* 반응형 스타일 */
  @media (max-width: 768px) {
    .lang-name {
      display: none;
    }
    
    .language-dropdown {
      right: -5px;
    }
  }
</style>

<script>
  // 모바일에서 클릭/터치 지원
  document.addEventListener('DOMContentLoaded', function() {
    const languageSelector = document.querySelector('.language-selector');
    const dropdown = document.querySelector('.language-dropdown');
    
    // 모바일에서 클릭 이벤트
    let isOpen = false;
    languageSelector.addEventListener('click', function(e) {
      // 링크 클릭은 무시 (이벤트 버블링으로 인해)
      if (e.target.tagName === 'A' || e.target.closest('a')) {
        return;
      }
      
      if (isOpen) {
        dropdown.style.display = 'none';
        isOpen = false;
      } else {
        dropdown.style.display = 'block';
        isOpen = true;
      }
    });
    
    // 외부 클릭 시 닫기
    document.addEventListener('click', function(e) {
      if (!languageSelector.contains(e.target)) {
        dropdown.style.display = '';
        isOpen = false;
      }
    });
  });
</script>
